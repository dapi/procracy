# Use Case: Награда за решённую issue

## Акторы
- **Гражданин** — автор PR
- **CI система** — автоматическое начисление

## Предусловия
- Гражданин зарегистрирован в системе (имеет счёт в `bank/balances.json`)
- Существует открытая issue в репозитории
- В `treasury` достаточно средств (≥ 10 merits)

## Основной сценарий

1. Гражданин берёт issue в работу
2. Гражданин создаёт PR, закрывающий issue (через `Closes #N` в описании)
3. PR проходит ревью и мержится в master
4. CI workflow `issue-reward.yml` срабатывает на событие `pull_request.closed`
5. Workflow проверяет, что PR был merged (не просто закрыт)
6. Workflow получает список закрытых issues через `gh pr view --json closingIssuesReferences`
7. Для каждой закрытой issue: скрипт `reward-issue.mjs` переводит 10 merits из `treasury` на счёт автора PR
8. Workflow коммитит изменения в `bank/` и пушит в master

## Альтернативные сценарии

### PR не закрывает ни одной issue
- Workflow обнаруживает пустой список issues
- Награда не начисляется, workflow завершается без коммита

### PR закрывает несколько issues
- Награда начисляется за каждую issue отдельно (10 merits × количество issues)

### Недостаточно средств в treasury
- Скрипт завершается с ошибкой
- Workflow падает, награда не начисляется
- Требуется ручное вмешательство (эмиссия)

### Автор не имеет счёта
- Скрипт завершается с ошибкой (аккаунт не существует)
- Гражданин должен сначала пройти регистрацию

## Результат
- Баланс автора увеличен на 10 merits за каждую закрытую issue
- Транзакция записана в `bank/transactions.json` с reason `Награда за issue #N (PR #M)`
- Баланс `treasury` уменьшен на соответствующую сумму
